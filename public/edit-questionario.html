<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Questionário</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

    <div class="container mt-2">
        <h1 class="mb-4">Editar Questionário</h1>

        <form id="editQuestionarioForm">
            <input type="hidden" id="id" name="id">
            <div class="mb-3">
                <label for="title" class="form-label">Título</label>
                <input type="text" class="form-control" id="title" name="title" required>
            </div>

            <div class="mb-3">
                <label for="description" class="form-label">Descrição</label>
                <textarea class="form-control" id="description" name="description" rows="3"></textarea>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="category" class="form-label">Categoria</label>
                    <input type="text" class="form-control" id="category" name="category">
                </div>
                <div class="col-md-6">
                    <label for="target_user_type" class="form-label">Tipo de Usuário Alvo</label>
                    <input type="text" class="form-control" id="target_user_type" name="target_user_type">
                </div>
            </div>

            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="is_active" name="is_active">
                <label class="form-check-label" for="is_active">
                    Ativo
                </label>
            </div>

            <button type="submit" class="btn btn-primary">Salvar Alterações</button>
            <a href="questionario.html" class="btn btn-secondary">Cancelar</a>
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script>
        $(document).ready(function () {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');

            if (id) {
                // Fetch existing data
                $.ajax({
                    url: `/questionarios/${id}`,
                    type: 'GET',
                    success: function (data) {
                        $('#id').val(data.id);
                        $('#title').val(data.title);
                        $('#description').val(data.description);
                        $('#category').val(data.category);
                        $('#target_user_type').val(data.target_user_type);
                        $('#is_active').prop('checked', data.is_active);
                    },
                    error: function () {
                        alert('Erro ao carregar dados do questionário.');
                    }
                });
            } else {
                alert('ID não fornecido.');
                window.location.href = 'questionario.html';
            }

            $('#editQuestionarioForm').on('submit', function (e) {
                e.preventDefault();

                const formData = {
                    title: $('#title').val(),
                    description: $('#description').val(),
                    category: $('#category').val(),
                    target_user_type: $('#target_user_type').val(),
                    is_active: $('#is_active').is(':checked'),
                    modified: new Date().toISOString().split("T")[0]
                };

                $.ajax({
                    url: `/questionarios/${id}`,
                    type: 'PUT',
                    contentType: 'application/json',
                    data: JSON.stringify(formData),
                    success: function () {
                        alert('Questionário atualizado com sucesso!');
                        window.location.href = 'view-questionario.html?id=' + id;
                    },
                    error: function (xhr) {
                        alert('Erro ao atualizar questionário: ' + xhr.responseText);
                    }
                });
            });
        });
    </script>
</body>

</html>